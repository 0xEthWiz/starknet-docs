<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing StarkNet contracts :: StarkNet documentation</title>
    <link rel="canonical" href="https://docs.starknet.io/hello-starknet/writing_contracts/">
    <link rel="next" href="../account_setup/">
    <meta name="generator" content="Antora 3.1.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129128514-2"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-129128514-2')</script>
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <img src="/_/img/starknet_logo.png" alt="StarkNet logo" width="40px" height="40px" style="margin-top: 10px">
      <a class="navbar-item" href="https://docs.starknet.io"><strong>StarkNet documentation</strong></a>
      <!-- <span class="vertical-separator-header">|</span> -->
        <div class="navbar-item search hide-for-print">
          <div id="search-field" class="field">
            <input id="search-input" type="text" placeholder="Search the docs" >
          </div>
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://starknet.io/docs/hello_starknet/index.html#hello-starknet" target="_blank">Hello StarkNet</a>
        <a class="navbar-item" href="https://community.starknet.io/" target="_blank">StarkNet Community Forum</a>
        <a class="navbar-item" href="http://starknet.io/discord" target="_blank">Discord</a>
      </div>
    </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hello-starknet" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="./">Hello StarkNet</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="./">Writing contracts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../account_setup/">Account setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amm/">AMM</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../calling_contracts/">Calling contracts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../user_auth/">User authentication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploying_from_contracts/">Deploying from contracts</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hello StarkNet</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="./">Hello StarkNet</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="./">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../documentation/">StarkNet</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../documentation/">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../documentation/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="./">Hello StarkNet</a></li>
    <li><a href="./">Writing contracts</a></li>
  </ul>
</nav>
<!--
  <div class="edit-this-page"><a href="https://github.com/starknet-community-libs/hello-starknet/edit/main/modules/ROOT/pages/writing_contracts.adoc">Edit this Page</a></div>
  -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Writing StarkNet contracts</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In order to follow this tutorial you should have basic familiarity with
writing Cairo code. For example, you can read the first few pages of the
<a href="https://starknet.io/docs/hello_cairo/index.html#hello-cairo">Hello,
Cairo</a> tutorial. You should also
<a href="https://starknet.io/docs/quickstart.html#quickstart">set up your
environment</a> and make sure your installed Cairo version is at least
<code>0.10.0</code> (you can check your version by running
<code>cairo-compile --version</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="your-first-contract"><a class="anchor" href="#your-first-contract"></a>Your first contract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s start by looking at the following StarkNet contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cairo hljs" data-lang="cairo">// Declare this file as a StarkNet contract.
%lang starknet

from starkware.cairo.common.cairo_builtins import HashBuiltin

// Define a storage variable.
@storage_var
func balance() -&gt; (res: felt) {
}

// Increases the balance by the given amount.
@external
func increase_balance{
    syscall_ptr: felt*,
    pedersen_ptr: HashBuiltin*,
    range_check_ptr,
}(amount: felt) {
    let (res) = balance.read();
    balance.write(res + amount);
    return ();
}

// Returns the current balance.
@view
func get_balance{
    syscall_ptr: felt*,
    pedersen_ptr: HashBuiltin*,
    range_check_ptr,
}() -&gt; (res: felt) {
    let (res) = balance.read();
    return (res=res);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line, <code>%lang starknet</code> declares that this file should be
read as a StarkNet contract file, rather than a regular Cairo program
file. Trying to compile this file with <code>cairo-compile</code> will result in
a compilation error. Compiling StarkNet contracts should be done with
the <code>starknet-compile</code> command as we shall see below.</p>
</div>
<div class="paragraph">
<p>Next, we have an import statement. If you’re not familiar with this type
of statement, refer to the
<a href="https://starknet.io/docs/hello_cairo/index.html#hello-cairo">Hello,
Cairo</a> tutorial. Note that you don’t need to explicitly use the
<code>%builtins</code> directive in StarkNet contracts.</p>
</div>
<div class="paragraph">
<p>The first new primitive that we see in the code is <code>@storage_var</code>.
Unlike a Cairo program, which is stateless, StarkNet contracts have a
state, called “the contract’s storage”. Transactions invoked on such
contracts may modify this state, in a way defined by the contract.</p>
</div>
<div class="paragraph">
<p>The <code>@storage_var</code> decorator declares a variable which will be kept as
part of this storage. In our case, this variable consists of a single
<code>felt</code>, called <code>balance</code>. To use this variable, we will use the
<code>balance.read()</code> and <code>balance.write()</code> functions which are
automatically created by the <code>@storage_var</code> decorator. When a contract
is deployed, all its storage cells are initialized to zero. In
particular, all storage variables are initially zero.</p>
</div>
<div class="paragraph">
<p>StarkNet contracts have no <code>main()</code> function. Instead, each function
may be annotated as an external function (using the <code>@external</code>
decorator). External functions may be called by the users of StarkNet,
and by other contracts (see
<a href="../calling_contracts/" class="xref page">Calling another contract</a>).</p>
</div>
<div class="paragraph">
<p>In our case, the contract has two external functions:
<code>increase_balance</code> reads the current value of balance from the
storage, adds the given amount to it and writes the new value back to
storage. <code>get_balance</code> simply reads the balance and returns its value.</p>
</div>
<div class="paragraph">
<p>The <code>@view</code> decorator is identical to the <code>@external</code> decorator. The
only difference is that the method is <em>annotated</em> as a method that only
queries the state rather than modifying it. Note that in the current
version this is not enforced by the compiler.</p>
</div>
<div class="paragraph">
<p>Consider the three implicit arguments: <code>syscall_ptr</code>, <code>pedersen_ptr</code>
and <code>range_check_ptr</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should be familiar with <code>pedersen_ptr</code>, which allows to compute
the Pedersen hash function, and <code>range_check_ptr</code>, which allows to
compare integers. But it seems that the contract doesn’t use any hash
function or integer comparison, so why are they needed? The reason is
that storage variables require these implicit arguments in order to
compute the actual memory address of this variable. This may not be
needed in simple variables such as <code>balance</code>, but with maps (see
<a href="../user_auth/#storage-maps" class="xref page">Storage maps</a>)
computing the Pedersen hash is part of what <code>read()</code> and <code>write()</code>
do.</p>
</li>
<li>
<p><code>syscall_ptr</code> is a new primitive, unique to StarkNet contracts (it
doesn’t exist in Cairo). <code>syscall_ptr</code> allows the code to invoke
system calls. It is also an implicit argument of <code>read()</code> and
<code>write()</code> (required, in this case, because storage access is done
using system calls).</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="programming_without_hints"><a class="anchor" href="#programming_without_hints"></a>Programming without hints</h3>
<div class="paragraph">
<p>If you are familiar with programming in Cairo, you are probably familiar
with <a href="https://starknet.io/docs/how_cairo_works/hints.html#hints">hints</a>.
Unfortunately (or fortunately, depending on your personal opinion),
using hints in StarkNet is not possible. This is due to the fact that
the contract’s author, the user invoking the function and the operator
running it are likely to be different entities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The operator cannot run arbitrary Python code due to security
concerns.</p>
</li>
<li>
<p>The user won’t be able to verify that the operator ran the hint the
contract author supplied.</p>
</li>
<li>
<p>It is not possible to prove that nondeterministic code <em>failed</em>, since
you should either prove you executed the hint or prove that for any hint
the code would’ve failed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For efficiency, hints are still used by the standard library functions,
through a mechanism of whitelisting (a function is whitelisted by an
operator if it agrees to run it, when it knows that it can run its hints
successfully. It doesn’t have to do with the question of the soundness
of the library function, which should be verified separately). This
means that not all the Cairo library functions can be used when writing
a StarkNet contract. See
<a href="https://github.com/starkware-libs/cairo-lang/blob/master/src/starkware/starknet/security/starknet_common.cairo">here</a>
for a list of the whitelisted library functions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compile-the-contract"><a class="anchor" href="#compile-the-contract"></a>Compile the contract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a file named <code>contract.cairo</code> and copy the contract code into
it.</p>
</div>
<div class="paragraph">
<p>Run the following command to compile your contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">starknet-compile contract.cairo \
    --output contract_compiled.json \
    --abi contract_abi.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, we can’t compile StarkNet contract using
<code>cairo-compile</code> and we need to use <code>starknet-compile</code> instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-contract-s-abi"><a class="anchor" href="#the-contract-s-abi"></a>The contract’s ABI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s examine the file <code>contract_abi.json</code> that was created during the
contract’s compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
    {
        "inputs": [
            {
                "name": "amount",
                "type": "felt"
            }
        ],
        "name": "increase_balance",
        "outputs": [],
        "type": "function"
    },
    {
        "inputs": [],
        "name": "get_balance",
        "outputs": [
            {
                "name": "res",
                "type": "felt"
            }
        ],
        "stateMutability": "view",
        "type": "function"
    }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ABI file contains a list of all the callable functions and their
expected inputs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declare-the-contract-on-the-starknet-testnet"><a class="anchor" href="#declare-the-contract-on-the-starknet-testnet"></a>Declare the contract on the StarkNet testnet</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to instruct the CLI to work with the StarkNet testnet you
should either pass <code>--network=alpha-goerli</code> on every use, or set the
<code>STARKNET_NETWORK</code> environment variable as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export STARKNET_NETWORK=alpha-goerli</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike Ethereum, StarkNet distinguishes between a contract class and a
contract instance. A contract class represents the code of a contract
(but with no state), while a contract instance represents a specific
instance of the class, with its own state.</p>
</div>
<div class="paragraph">
<p>Run the following command to declare your contract class on the StarkNet
testnet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">starknet declare --contract contract_compiled.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Declare transaction was sent.
Contract class hash: 0x1e2208b571b2cb68908f37a196ed5e391c8933a6db23bb3939acedee40d9b8a
Transaction hash: 0x762e166dd3326b2e263eb5bcfdccd225dc88e067fdf7c92cf8ce5e4ea01f9f1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here the class hash of your new contract. You’ll need this
class hash in order to deploy an instance of the contract using the
<a href="../deploying_from_contracts/" class="xref page">deploy
system call</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy_the_contract_on_the_starknet_testnet"><a class="anchor" href="#deploy_the_contract_on_the_starknet_testnet"></a>Deploy the contract on the StarkNet testnet</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The alpha release is an experimental release. Newer
versions may require a reset of the network’s state (resulting in the
removal of the deployed contracts).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the following command to deploy your contract on the StarkNet
testnet (replace <code>$CLASS_HASH</code> with the class hash you got from
<code>starknet declare</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">starknet deploy --class_hash $CLASS_HASH</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Invoke transaction for contract deployment was sent.
Contract address: 0x039564c4f6d9f45a963a6dc8cf32737f0d51a08e446304626173fd838bd70e1c
Transaction hash: 0x125e4bc5251af8ee2664ea0d1495b36c593f25f78f1a78f637a3f7aafa9e22</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here the address of your new contract. You’ll need this
address to interact with the contract.</p>
</div>
<div class="paragraph">
<p>Set the following environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># The deployment address of the previous contract.
export CONTRACT_ADDRESS="&lt;address of the previous contract&gt;"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interact_with_the_contract"><a class="anchor" href="#interact_with_the_contract"></a>Interact with the contract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the following command to invoke the <code>increase_balance()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">starknet invoke \
    --address ${CONTRACT_ADDRESS} \
    --abi contract_abi.json \
    --function increase_balance \
    --inputs 1234</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Invoke transaction was sent.
Contract address: 0x039564c4f6d9f45a963a6dc8cf32737f0d51a08e446304626173fd838bd70e1c
Transaction hash: 0x69d743891f69d758928e163eff1e3d7256752f549f134974d4aa8d26d5d7da8</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the use of fees in StarkNet, every interaction with a
contract through a function invocation must be done using an account. To
set up an account, see
<a href="../account_setup/" class="xref page">Setting up a
StarkNet account</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following command allows you to query the transaction status based
on the transaction hash that you got (here you’ll have to replace
<code>TRANSACTION_HASH</code> with the transaction hash printed by
<code>starknet invoke</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">starknet tx_status --hash TRANSACTION_HASH
[source,bash]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "block_hash": "0x0",
    "tx_status": "ACCEPTED_ON_L2"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The possible statuses are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOT_RECEIVED</code>: The transaction has not been received yet (i.e., not
written to storage).</p>
</li>
<li>
<p><code>RECEIVED</code>: The transaction was received by the sequencer.</p>
</li>
<li>
<p><code>PENDING</code>: The transaction passed the validation and entered the
pending block.</p>
</li>
<li>
<p><code>REJECTED</code>: The transaction failed validation and thus was skipped.</p>
</li>
<li>
<p><code>ACCEPTED_ON_L2</code>: The transaction passed the validation and entered
an actual created block.</p>
</li>
<li>
<p><code>ACCEPTED_ON_L1</code>: The transaction was accepted on-chain.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query_the_balance"><a class="anchor" href="#query_the_balance"></a>Query the balance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the following command to query the current balance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>starknet call \
    --address ${CONTRACT_ADDRESS} \
    --abi contract_abi.json \
    --function get_balance</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">1234</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To see the up-to-date balance you should wait until the
<code>increase_balance</code> transaction status is at least <code>ACCEPTED_ON_L2</code>
(that is, <code>ACCEPTED_ON_L2</code> or <code>ACCEPTED_ON_L1</code>). Otherwise, you’ll
see the balance before the execution of the <code>increase_balance</code>
transaction (that is, 0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the next section we will describe other CLI functions for querying
StarkNet’s state. Note that while <code>deploy</code> and <code>invoke</code> affect
StarkNet’s state, all other functions are read-only. In particular,
using <code>call</code> instead of <code>invoke</code> on a function that may change the
state, such as <code>increase_balance</code>, will return the result of the
function without actually applying it to the current state, allowing the
user to dry-run before committing to a state update.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="next"><a href="../account_setup/">Account setup</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
<!--  <p>&copy; 2020-2022 StarkWare Industries</p> -->
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: { inlineMath: [["\\(", "\\)"]], displayMath: [["\\[", "\\]"]], ignoreClass: "nostem|nolatexmath" },
  asciimath2jax: { delimiters: [["\\$", "\\$"]], ignoreClass: "nostem|noasciimath" },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
  </body>
</html>
